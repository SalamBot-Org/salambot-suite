# SalamBot API Gateway Enterprise - Configuration Environment de Test
# =============================================================================
# Ce fichier contient les variables d'environnement spécifiques aux tests
# d'intégration pour éviter les conflits avec l'environnement de développement

# -----------------------------------------------------------------------------
# SERVER CONFIGURATION
# -----------------------------------------------------------------------------
NODE_ENV=test
PORT=3000
HOST=127.0.0.1

# -----------------------------------------------------------------------------
# SECURITY & AUTHENTICATION (Valeurs de test)
# -----------------------------------------------------------------------------
JWT_SECRET=test-jwt-secret-for-integration-tests-only
JWT_EXPIRES_IN=1h
JWT_REFRESH_EXPIRES_IN=24h

# API Keys pour les tests
API_KEY_HEADER=X-API-Key
API_KEYS=test-api-key-1,test-api-key-2

# Encryption key pour les tests
ENCRYPTION_KEY=test-32-character-encryption-key

# -----------------------------------------------------------------------------
# REDIS CONFIGURATION (Test)
# -----------------------------------------------------------------------------
REDIS_URL=redis://localhost:6379
REDIS_TLS=false
REDIS_PASSWORD=
REDIS_DB=15
REDIS_KEY_PREFIX=salambot:test:gateway:
REDIS_TTL=300

# -----------------------------------------------------------------------------
# MICROSERVICES ENDPOINTS (Services Mock)
# -----------------------------------------------------------------------------
# Genkit AI Flows Service (Mock)
GENKIT_SERVICE_URL=http://localhost:3001
GENKIT_FLOWS_URL=http://localhost:3001
GENKIT_SERVICE_TIMEOUT=3000
GENKIT_SERVICE_RETRIES=1

# REST API Service (Mock)
REST_API_SERVICE_URL=http://localhost:3002
REST_API_URL=http://localhost:3002
REST_API_SERVICE_TIMEOUT=2000
REST_API_SERVICE_RETRIES=1

# WebSocket Service (Mock)
WEBSOCKET_SERVICE_URL=http://localhost:3003
WEBSOCKET_URL=http://localhost:3003
WEBSOCKET_SERVICE_TIMEOUT=1500
WEBSOCKET_SERVICE_RETRIES=1

# -----------------------------------------------------------------------------
# RATE LIMITING (Valeurs relaxées pour les tests)
# -----------------------------------------------------------------------------
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX_REQUESTS=1000
RATE_LIMIT_SKIP_SUCCESSFUL_REQUESTS=true
RATE_LIMIT_SKIP_FAILED_REQUESTS=true

# Rate limiting par endpoint (valeurs élevées pour les tests)
RATE_LIMIT_AUTH_MAX=100
RATE_LIMIT_AI_MAX=200
RATE_LIMIT_API_MAX=500

# -----------------------------------------------------------------------------
# CORS CONFIGURATION (Permissif pour les tests)
# -----------------------------------------------------------------------------
CORS_ORIGIN=http://localhost:3000,http://127.0.0.1:3000
CORS_CREDENTIALS=true
CORS_METHODS=GET,HEAD,PUT,PATCH,POST,DELETE,OPTIONS
CORS_ALLOWED_HEADERS=Content-Type,Authorization,X-API-Key,X-Request-ID

# -----------------------------------------------------------------------------
# LOGGING CONFIGURATION (Minimal pour les tests)
# -----------------------------------------------------------------------------
LOG_LEVEL=error
LOG_FORMAT=json
LOG_FILE_ENABLED=false
LOG_FILE_PATH=./logs/test-gateway.log
LOG_FILE_MAX_SIZE=1m
LOG_FILE_MAX_FILES=1

# Logging des requêtes (désactivé pour les tests)
LOG_SENSITIVE_DATA=false
LOG_REQUEST_BODY=false
LOG_RESPONSE_BODY=false

# -----------------------------------------------------------------------------
# MONITORING & METRICS (Simplifié pour les tests)
# -----------------------------------------------------------------------------
METRICS_ENABLED=true
METRICS_PATH=/metrics
METRICS_COLLECT_DEFAULT=false
METRICS_PREFIX=salambot_test_gateway_

# Prometheus Push Gateway (désactivé pour les tests)
PROMETHEUS_PUSH_GATEWAY_URL=
PROMETHEUS_PUSH_INTERVAL=30000

# -----------------------------------------------------------------------------
# CIRCUIT BREAKER (Désactivé pour les tests)
# -----------------------------------------------------------------------------
CIRCUIT_BREAKER_ENABLED=false
CIRCUIT_BREAKER_TEST_MODE=true
CIRCUIT_BREAKER_FAILURE_THRESHOLD=10
CIRCUIT_BREAKER_RESET_TIMEOUT=5000
CIRCUIT_BREAKER_MONITOR_INTERVAL=1000

# -----------------------------------------------------------------------------
# HEALTH CHECK (Fréquence réduite pour les tests)
# -----------------------------------------------------------------------------
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_INTERVAL=10000
HEALTH_CHECK_TIMEOUT=2000
HEALTH_CHECK_RETRIES=2

# Services à vérifier (uniquement les mocks)
HEALTH_CHECK_SERVICES=redis,genkit-mock,rest-api-mock

# -----------------------------------------------------------------------------
# CACHE CONFIGURATION (TTL réduit pour les tests)
# -----------------------------------------------------------------------------
CACHE_ENABLED=true
CACHE_DEFAULT_TTL=60
CACHE_MAX_SIZE=100
CACHE_CHECK_PERIOD=10

# Cache par type de données
CACHE_AUTH_TTL=30
CACHE_LANGUAGE_DETECTION_TTL=60
CACHE_AI_RESPONSE_TTL=30

# -----------------------------------------------------------------------------
# TIMEOUT CONFIGURATION (Valeurs réduites pour les tests)
# -----------------------------------------------------------------------------
REQUEST_TIMEOUT=5000
KEEP_ALIVE_TIMEOUT=2000
HEADERS_TIMEOUT=3000

# Timeouts par service (optimisés pour les tests)
AUTH_SERVICE_TIMEOUT=1500
AI_SERVICE_TIMEOUT=3000
DATA_SERVICE_TIMEOUT=2000

# Timeouts spécifiques aux tests
TEST_REQUEST_TIMEOUT=3000
TEST_CONNECTION_TIMEOUT=1000
TEST_RESPONSE_TIMEOUT=2000

# -----------------------------------------------------------------------------
# FEATURE FLAGS (Configuration de test)
# -----------------------------------------------------------------------------
FEATURE_DARIJA_DETECTION=true
FEATURE_AI_FALLBACK=true
FEATURE_CACHE_OPTIMIZATION=true
FEATURE_ADVANCED_METRICS=false
FEATURE_EXPERIMENTAL_FLOWS=false

# -----------------------------------------------------------------------------
# TEST SPECIFIC CONFIGURATION
# -----------------------------------------------------------------------------
# Désactiver les services externes réels
DISABLE_EXTERNAL_SERVICES=true

# Utiliser les mocks
USE_MOCK_SERVICES=true

# Désactiver les appels réseau réels
DISABLE_NETWORK_CALLS=false

# Configuration pour les tests de charge
LOAD_TEST_MODE=false
LOAD_TEST_CONCURRENT_USERS=10
LOAD_TEST_DURATION=30

# Configuration pour les tests de performance
PERFORMANCE_TEST_MODE=false
PERFORMANCE_THRESHOLD_MS=100

# Configuration pour les tests de sécurité
SECURITY_TEST_MODE=false
SECURITY_STRICT_MODE=true

# -----------------------------------------------------------------------------
# MOCK SERVICES CONFIGURATION
# -----------------------------------------------------------------------------
# Ports des services mock
MOCK_GENKIT_PORT=3001
MOCK_REST_API_PORT=3002
MOCK_WEBSOCKET_PORT=3003
MOCK_PROMETHEUS_PORT=9090

# Configuration des délais de réponse des mocks
MOCK_RESPONSE_DELAY_MS=50
MOCK_ERROR_RATE_PERCENT=5
MOCK_TIMEOUT_RATE_PERCENT=2

# Configuration des données de test
TEST_DATA_RESET_BETWEEN_TESTS=true
TEST_DATA_SEED=12345
TEST_DATA_CLEANUP_ENABLED=true