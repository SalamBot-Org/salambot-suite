# Configuration d'environnement pour CI/CD
# SalamBot Functions-Run - API Gateway Enterprise
# Optimisé pour compatibilité cross-platform (Windows local / Ubuntu CI)

# === CONFIGURATION GÉNÉRALE ===
NODE_ENV=test
LOG_LEVEL=error
METRICS_ENABLED=true
NODE_NO_WARNINGS=1

# === TIMEOUTS OPTIMISÉS POUR CI ===
# Timeouts généraux
REQUEST_TIMEOUT=10000
HEALTH_CHECK_TIMEOUT=5000

# Timeouts spécifiques aux tests
TEST_REQUEST_TIMEOUT=8000
TEST_CONNECTION_TIMEOUT=3000
TEST_RESPONSE_TIMEOUT=5000

# Timeouts pour les services mock
MOCK_SERVICE_STARTUP_TIMEOUT=30000
MOCK_SERVICE_HEALTH_TIMEOUT=10000
MOCK_RESPONSE_DELAY_MS=50

# === CONFIGURATION JEST ===
JEST_TIMEOUT=30000
JEST_WORKER_ID=1

# === SERVICES MOCK - TAUX D'ERREUR RÉDUITS POUR CI ===
MOCK_SERVICES_ENABLED=true
MOCK_GENKIT_PORT=3001
MOCK_REST_API_PORT=3002
MOCK_WEBSOCKET_PORT=3003
MOCK_PROMETHEUS_PORT=3004

# Taux d'erreur réduits pour stabilité CI
MOCK_ERROR_RATE_PERCENT=1
MOCK_TIMEOUT_RATE_PERCENT=0

# === CONFIGURATION REDIS POUR CI ===
REDIS_DB=15
REDIS_KEY_PREFIX=salambot:test:gateway:
REDIS_TLS=false
REDIS_REJECT_UNAUTHORIZED=false
REDIS_ENABLE_TLS=false

# Timeouts Redis optimisés pour CI
REDIS_CONNECT_TIMEOUT=5000
REDIS_COMMAND_TIMEOUT=3000
REDIS_RETRY_DELAY_ON_FAILOVER=200
REDIS_RETRY_ATTEMPTS=3

# Configuration spécifique Ubuntu CI
REDIS_FAMILY=4
REDIS_KEEP_ALIVE=30000
REDIS_LAZY_CONNECT=true

# === CIRCUIT BREAKERS ===
CIRCUIT_BREAKER_ENABLED=false
CIRCUIT_BREAKER_TEST_MODE=true

# === CONFIGURATION RÉSEAU ===
# Headers pour identification en CI
CI_USER_AGENT=SalamBot-Test-CI/1.0
CI_ACCEPT_HEADER=application/json

# === CONFIGURATION PERFORMANCE ===
# Seuils de performance ajustés pour CI
PERFORMANCE_HEALTH_CHECK_THRESHOLD=2000
PERFORMANCE_LANGUAGE_DETECTION_THRESHOLD=3000
PERFORMANCE_REPLY_GENERATION_THRESHOLD=4000
PERFORMANCE_INTEGRATION_THRESHOLD=8000

# === CONFIGURATION SPÉCIFIQUE UBUNTU ===
# Variables pour compatibilité Ubuntu CI
CI_PLATFORM=ubuntu
NODE_OPTIONS=--max-old-space-size=4096

# === RETRY ET ROBUSTESSE ===
# Configuration retry pour tests flaky
TEST_MAX_RETRIES=5
TEST_RETRY_DELAY=2000
TEST_BACKOFF_MULTIPLIER=2

# === LOGGING ET DEBUG ===
# Configuration logging pour CI
MOCK_LOG_LEVEL=warn
TEST_VERBOSE=false
DEBUG_MOCK_SERVICES=false